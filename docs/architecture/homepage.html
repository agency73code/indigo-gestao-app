<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indigo ‚Äî Toasts (Rascunho / Finaliza√ß√£o)</title>
  <style>
    :root{
      --bg:#0f172a;
      --surface:#0b1224;
      --card:#0b1224;
      --stroke:rgba(255,255,255,.10);
      --text:#e5e7eb;
      --muted:rgba(229,231,235,.7);
      --primary:#2563eb;
      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 16px;
      --radius-sm: 12px;
      --pad: 16px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      background: radial-gradient(1200px 600px at 30% -10%, rgba(37,99,235,.25), transparent 55%),
                  radial-gradient(1200px 600px at 90% 10%, rgba(34,197,94,.14), transparent 55%),
                  var(--bg);
      color:var(--text);
      display:flex;
      justify-content:center;
      padding:24px;
    }

    .app{
      width:min(420px, 100%);
      background: rgba(11,18,36,.55);
      border:1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px var(--pad);
      border-bottom: 1px solid var(--stroke);
      background: rgba(11,18,36,.75);
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .title strong{ font-size:14px; letter-spacing:.2px; }
    .title span{ font-size:12px; color:var(--muted); }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      color:var(--muted);
      font-size:12px;
      background: rgba(255,255,255,.04);
      user-select:none;
    }
    .dot{
      width:9px;height:9px;border-radius:999px;background:var(--ok);
      box-shadow:0 0 0 4px rgba(34,197,94,.15);
    }
    .dot.offline{ background: var(--warn); box-shadow:0 0 0 4px rgba(245,158,11,.15); }
    .dot.error{ background: var(--danger); box-shadow:0 0 0 4px rgba(239,68,68,.15); }

    .content{
      padding: 16px;
      min-height: 560px;
    }

    .screen{
      display:none;
      animation: fadeIn .18s ease-out;
    }
    .screen.active{ display:block; }

    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .card{
      padding: 14px;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
    }

    .h1{
      font-size:18px;
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .p{
      margin:0;
      color:var(--muted);
      line-height:1.35;
      font-size:13px;
    }

    .grid{
      display:grid;
      gap:12px;
      margin-top:14px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 12px;
    }

    button{
      appearance:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.2px;
      font-size:13px;
    }
    button.primary{
      background: rgba(37,99,235,.15);
      border-color: rgba(37,99,235,.35);
    }
    button.danger{
      background: rgba(239,68,68,.12);
      border-color: rgba(239,68,68,.35);
    }
    button:active{ transform: translateY(1px); }

    .split{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.02);
    }
    .split small{ color:var(--muted); }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      border:1px solid transparent;
      user-select:none;
    }
    .badge.ok{ background: rgba(34,197,94,.14); border-color: rgba(34,197,94,.30); color:#bbf7d0; }
    .badge.draft{ background: rgba(245,158,11,.14); border-color: rgba(245,158,11,.30); color:#fde68a; }
    .badge.final{ background: rgba(37,99,235,.14); border-color: rgba(37,99,235,.30); color:#bfdbfe; }

    /* Toast */
    .toast-wrap{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 18px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index: 9999;
    }
    .toast{
      width: min(420px, calc(100% - 24px));
      background: rgba(11,18,36,.92);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 12px 12px;
      box-shadow: var(--shadow);
      display:flex;
      gap:12px;
      align-items:flex-start;
      transform: translateY(16px);
      opacity: 0;
      transition: transform .18s ease, opacity .18s ease;
      pointer-events:auto;
      backdrop-filter: blur(10px);
    }
    .toast.show{
      transform: translateY(0);
      opacity: 1;
    }
    .toast .icon{
      width: 28px;
      height: 28px;
      border-radius: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
      margin-top: 1px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight:900;
    }
    .toast .body{ flex:1; }
    .toast .body strong{
      display:block;
      font-size:13px;
      letter-spacing:.2px;
      margin-bottom: 2px;
    }
    .toast .body span{
      display:block;
      font-size:12px;
      color: var(--muted);
      line-height: 1.25;
    }
    .toast .actions{
      display:flex;
      gap:8px;
      align-items:center;
      margin-left: 6px;
    }
    .toast .link{
      pointer-events:auto;
      border:none;
      background: transparent;
      color: #bfdbfe;
      padding: 6px 8px;
      border-radius: 10px;
      font-weight:800;
      cursor:pointer;
      font-size:12px;
    }
    .toast .close{
      pointer-events:auto;
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--text);
      cursor:pointer;
      font-weight:900;
    }

    /* Footer nav */
    .footer{
      padding: 12px 16px;
      border-top: 1px solid var(--stroke);
      background: rgba(11,18,36,.75);
      display:flex;
      gap:10px;
    }
    .footer button{
      flex: 1;
      padding: 12px 12px;
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Demo Indigo Toasts">
    <div class="topbar">
      <div class="title">
        <strong id="topTitle">Nova sess√£o</strong>
        <span id="topSub">Demo de feedback (rascunho / finaliza√ß√£o)</span>
      </div>

      <div class="pill" id="netPill" title="Simula√ß√£o de conectividade">
        <span class="dot" id="netDot"></span>
        <span id="netLabel">Conectado</span>
      </div>
    </div>

    <div class="content">
      <!-- SCREEN: REGISTRO -->
      <section class="screen active" id="screen-registro">
        <div class="card">
          <h2 class="h1">Registro r√°pido</h2>
          <p class="p">
            Aqui √© o ‚Äúdurante sess√£o‚Äù: foco no registro. As a√ß√µes abaixo simulam
            o que acontece quando o terapeuta decide <b>Salvar rascunho</b> ou <b>Finalizar</b>.
          </p>

          <div class="grid">
            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">Sess√£o em andamento</div>
                <small>Voc√™ pode registrar e sair r√°pido.</small>
              </div>
              <span class="badge draft" id="sessionStateBadge">EM REGISTRO</span>
            </div>

            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">Regras simuladas</div>
                <small>Finalizar manda pra fila de sync.</small>
              </div>
              <small id="ruleHint">Sem valida√ß√µes aqui (√© s√≥ demo).</small>
            </div>
          </div>

          <div class="row">
            <button class="primary" id="btnSalvarRascunho">Salvar rascunho</button>
            <button class="primary" id="btnFinalizar">Finalizar sess√£o</button>
          </div>

          <div class="row" style="margin-top:16px;">
            <button id="btnToggleOnline">Alternar Online/Offline</button>
            <button class="danger" id="btnForceError">Simular erro de sync</button>
          </div>

          <p class="p" style="margin-top:12px;">
            Dica: salve rascunho e veja que vai pra Home; finalize e veja que abre Detalhes com status.
          </p>
        </div>
      </section>

      <!-- SCREEN: HOME -->
      <section class="screen" id="screen-home">
        <div class="card">
          <h2 class="h1">Home</h2>
          <p class="p">
            Aqui voc√™ veria cards e alertas. Simula√ß√£o abaixo:
          </p>

          <div class="grid">
            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">Sess√µes pendentes</div>
                <small id="pendingText">Nenhuma</small>
              </div>
              <span class="badge draft" id="pendingBadge" style="display:none;">PENDENTE</span>
            </div>

            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">√öltima a√ß√£o</div>
                <small id="lastAction">‚Äî</small>
              </div>
              <button class="primary" id="btnAbrirSessao">Abrir sess√£o</button>
            </div>
          </div>
        </div>
      </section>

      <!-- SCREEN: DETALHES -->
      <section class="screen" id="screen-detalhes">
        <div class="card">
          <h2 class="h1">Detalhes da sess√£o</h2>
          <p class="p">
            Em vez de tela ‚Äúüéâ sucesso‚Äù, voc√™ cai aqui e enxerga
            <b>estado + sincroniza√ß√£o</b>. Isso √© o ‚Äúprofissional‚Äù.
          </p>

          <div class="grid" style="margin-top:14px;">
            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">Status da sess√£o</div>
                <small id="detailSessionState">Finalizada</small>
              </div>
              <span class="badge final" id="detailStateBadge">FINALIZADA</span>
            </div>

            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">Sincroniza√ß√£o</div>
                <small id="detailSyncText">‚Äî</small>
              </div>
              <span class="badge ok" id="detailSyncBadge">OK</span>
            </div>

            <div class="split">
              <div>
                <div style="font-weight:800; font-size:13px;">A√ß√£o sugerida</div>
                <small id="detailHint">‚Äî</small>
              </div>
              <button id="btnTentarSync" class="primary">Tentar sincronizar</button>
            </div>
          </div>

          <div class="row" style="margin-top:14px;">
            <button id="btnVoltarHome">Voltar para Home</button>
            <button id="btnNovaSessao" class="primary">Nova sess√£o</button>
          </div>
        </div>
      </section>
    </div>

    <div class="footer">
      <button id="navRegistro" class="primary">Registro</button>
      <button id="navHome">Home</button>
      <button id="navDetalhes">Detalhes</button>
    </div>
  </div>

  <!-- Toast container -->
  <div class="toast-wrap" aria-live="polite" aria-atomic="true">
    <div class="toast" id="toast" role="status">
      <div class="icon" id="toastIcon">‚úì</div>
      <div class="body">
        <strong id="toastTitle">‚Äî</strong>
        <span id="toastMsg">‚Äî</span>
      </div>
      <div class="actions">
        <button class="link" id="toastAction" style="display:none;">Ver</button>
        <button class="close" id="toastClose" aria-label="Fechar">√ó</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // App state (simples)
  const state = {
    online: true,
    pendingDraft: false,
    sessionFinalized: false,
    forceSyncError: false,
    lastAction: "‚Äî",
  };

  // Elements
  const screens = {
    registro: document.getElementById("screen-registro"),
    home: document.getElementById("screen-home"),
    detalhes: document.getElementById("screen-detalhes"),
  };

  const topTitle = document.getElementById("topTitle");
  const netDot = document.getElementById("netDot");
  const netLabel = document.getElementById("netLabel");

  const pendingText = document.getElementById("pendingText");
  const pendingBadge = document.getElementById("pendingBadge");
  const lastAction = document.getElementById("lastAction");

  const detailSyncText = document.getElementById("detailSyncText");
  const detailSyncBadge = document.getElementById("detailSyncBadge");
  const detailHint = document.getElementById("detailHint");

  // Toast
  const toastEl = document.getElementById("toast");
  const toastIcon = document.getElementById("toastIcon");
  const toastTitle = document.getElementById("toastTitle");
  const toastMsg = document.getElementById("toastMsg");
  const toastClose = document.getElementById("toastClose");
  const toastAction = document.getElementById("toastAction");
  let toastTimer = null;

  function setOnline(online) {
    state.online = online;
    netDot.classList.toggle("offline", !online);
    netDot.classList.remove("error");
    netLabel.textContent = online ? "Conectado" : "Offline";
  }

  function setNetError() {
    netDot.classList.remove("offline");
    netDot.classList.add("error");
    netLabel.textContent = "Erro";
  }

  function showScreen(name) {
    Object.values(screens).forEach(s => s.classList.remove("active"));
    screens[name].classList.add("active");
    topTitle.textContent =
      name === "registro" ? "Nova sess√£o"
      : name === "home" ? "Home"
      : "Sess√£o";
  }

  function renderHome() {
    pendingText.textContent = state.pendingDraft
      ? "1 rascunho para concluir"
      : "Nenhuma";
    pendingBadge.style.display = state.pendingDraft ? "inline-flex" : "none";
    lastAction.textContent = state.lastAction;
  }

  function renderDetalhes() {
    // estado de sync
    if (!state.sessionFinalized) {
      detailSyncText.textContent = "‚Äî";
      detailSyncBadge.textContent = "‚Äî";
      detailSyncBadge.className = "badge";
      detailHint.textContent = "Finalize uma sess√£o para ver o status aqui.";
      return;
    }

    if (!state.online) {
      detailSyncText.textContent = "Aguardando sincroniza√ß√£o (offline)";
      detailSyncBadge.textContent = "PENDENTE";
      detailSyncBadge.className = "badge draft";
      detailHint.textContent = "Conecte-se √† internet para sincronizar.";
      return;
    }

    if (state.forceSyncError) {
      detailSyncText.textContent = "Falha ao sincronizar";
      detailSyncBadge.textContent = "ERRO";
      detailSyncBadge.className = "badge";
      detailSyncBadge.style.background = "rgba(239,68,68,.12)";
      detailSyncBadge.style.borderColor = "rgba(239,68,68,.35)";
      detailSyncBadge.style.color = "#fecaca";
      detailHint.textContent = "Tente novamente. Se persistir, contate o suporte.";
      return;
    }

    detailSyncText.textContent = "Sincronizada com sucesso";
    detailSyncBadge.textContent = "OK";
    detailSyncBadge.className = "badge ok";
    detailSyncBadge.style.background = "";
    detailSyncBadge.style.borderColor = "";
    detailSyncBadge.style.color = "";
    detailHint.textContent = "Tudo certo. A sess√£o j√° entrou no fluxo.";
  }

  function toast({ type="success", title, message, actionLabel, onAction, duration=2200 }) {
    // reset action
    toastAction.style.display = "none";
    toastAction.onclick = null;

    // icon
    if (type === "success") toastIcon.textContent = "‚úì";
    if (type === "info") toastIcon.textContent = "i";
    if (type === "warning") toastIcon.textContent = "!";
    if (type === "error") toastIcon.textContent = "√ó";

    toastTitle.textContent = title;
    toastMsg.textContent = message;

    if (actionLabel && typeof onAction === "function") {
      toastAction.style.display = "inline-flex";
      toastAction.textContent = actionLabel;
      toastAction.onclick = () => {
        hideToast();
        onAction();
      };
    }

    // show
    clearTimeout(toastTimer);
    toastEl.classList.add("show");

    // auto hide
    toastTimer = setTimeout(hideToast, duration);
  }

  function hideToast() {
    toastEl.classList.remove("show");
    clearTimeout(toastTimer);
    toastTimer = null;
  }

  toastClose.addEventListener("click", hideToast);

  // Actions
  function saveDraft() {
    state.pendingDraft = true;
    state.sessionFinalized = false;
    state.lastAction = "Rascunho salvo";
    toast({
      type: "success",
      title: "Rascunho salvo",
      message: "Voc√™ pode concluir depois.",
      duration: 2000,
    });

    // redireciona pra Home (sem tela de sucesso)
    setTimeout(() => {
      showScreen("home");
      renderHome();
    }, 350);
  }

  function finalizeSession() {
    // finaliza e manda pra "detalhes"
    state.pendingDraft = false;
    state.sessionFinalized = true;
    state.lastAction = "Sess√£o finalizada";

    toast({
      type: "success",
      title: "Sess√£o finalizada",
      message: state.online ? "Enviando para sincroniza√ß√£o..." : "Aguardando sincroniza√ß√£o (offline).",
      actionLabel: "Ver",
      onAction: () => { showScreen("detalhes"); renderDetalhes(); },
      duration: 2400,
    });

    setTimeout(() => {
      showScreen("detalhes");
      renderDetalhes();
      renderHome();
    }, 350);
  }

  function trySync() {
    if (!state.sessionFinalized) return;

    if (!state.online) {
      toast({
        type: "warning",
        title: "Sem conex√£o",
        message: "Conecte-se para sincronizar.",
        duration: 2400,
      });
      renderDetalhes();
      return;
    }

    if (state.forceSyncError) {
      toast({
        type: "error",
        title: "Falha na sincroniza√ß√£o",
        message: "Tente novamente em instantes.",
        duration: 2600,
      });
      renderDetalhes();
      return;
    }

    toast({
      type: "success",
      title: "Sincronizada",
      message: "Sess√£o enviada com sucesso.",
      duration: 2200,
    });
    renderDetalhes();
  }

  // Buttons
  document.getElementById("btnSalvarRascunho").addEventListener("click", saveDraft);
  document.getElementById("btnFinalizar").addEventListener("click", finalizeSession);

  document.getElementById("btnAbrirSessao").addEventListener("click", () => {
    showScreen("registro");
  });

  document.getElementById("btnVoltarHome").addEventListener("click", () => {
    showScreen("home");
    renderHome();
  });

  document.getElementById("btnNovaSessao").addEventListener("click", () => {
    // reset s√≥ para demo
    state.pendingDraft = false;
    state.sessionFinalized = false;
    state.forceSyncError = false;
    state.lastAction = "‚Äî";
    setOnline(true);
    showScreen("registro");
    renderHome();
    renderDetalhes();
    toast({ type:"info", title:"Nova sess√£o", message:"Fluxo reiniciado.", duration: 1600 });
  });

  document.getElementById("btnTentarSync").addEventListener("click", trySync);

  document.getElementById("btnToggleOnline").addEventListener("click", () => {
    state.forceSyncError = false; // reset erro ao alternar
    setOnline(!state.online);
    renderDetalhes();
    toast({
      type: state.online ? "info" : "warning",
      title: state.online ? "Conectado" : "Offline",
      message: state.online ? "A sincroniza√ß√£o pode ocorrer." : "Sess√µes ficar√£o pendentes.",
      duration: 2000
    });
  });

  document.getElementById("btnForceError").addEventListener("click", () => {
    if (!state.sessionFinalized) {
      toast({ type:"warning", title:"Nada para sincronizar", message:"Finalize uma sess√£o primeiro.", duration: 2200 });
      return;
    }
    if (!state.online) {
      toast({ type:"warning", title:"Offline", message:"Conecte-se para simular erro de sync.", duration: 2200 });
      return;
    }
    state.forceSyncError = true;
    setNetError();
    renderDetalhes();
    toast({ type:"error", title:"Erro simulado", message:"Sincroniza√ß√£o falhou.", duration: 2400 });
  });

  // Footer nav
  document.getElementById("navRegistro").addEventListener("click", () => showScreen("registro"));
  document.getElementById("navHome").addEventListener("click", () => { showScreen("home"); renderHome(); });
  document.getElementById("navDetalhes").addEventListener("click", () => { showScreen("detalhes"); renderDetalhes(); });

  // init
  setOnline(true);
  renderHome();
  renderDetalhes();
})();
</script>
</body>
</html>